MYB 226 investigation:

This curl works:

curl -u 904715:testuser "http://localhost:8080/var/message/box.json?box=drafts&category=message&items=12&page=0&_=1288717705291"

This one fails, causing errors in the Queue list page:
curl -u 904715:testuser "http://localhost:8080/var/message/box.json?box=drafts&category=message&items=12&page=1&_=1288717705291"

The page=1 value causes an err in SearchServlet:

<h1>Internal Server Error (500)</h1>
<p>The requested URL /var/message/box.json resulted in an error in org.sakaiproject.nakamura.search.SearchServlet.</p>
<h3>Exception:</h3>
<pre>
java.util.NoSuchElementException
	at org.sakaiproject.nakamura.api.search.ValidatingRowIterator.nextRow(ValidatingRowIterator.java:51)
	at org.sakaiproject.nakamura.api.search.ValidatingRowIterator.skip(ValidatingRowIterator.java:85)
	at org.sakaiproject.nakamura.search.SearchServiceFactoryImpl.getSearchResultSet(SearchServiceFactoryImpl.java:91)
	at org.sakaiproject.nakamura.message.MessageSearchResultProcessor.getSearchResultSet(MessageSearchResultProcessor.java:191)
	at org.sakaiproject.nakamura.search.SearchServlet.doGet(SearchServlet.java:349)
	at org.apache.sling.api.servlets.SlingSafeMethodsServlet.mayService(SlingSafeMethodsServlet.java:268)
	at org.apache.sling.api.servlets.SlingSafeMethodsServlet.service(SlingSafeMethodsServlet.java:344)
	at org.apache.sling.api.servlets.SlingSafeMethodsServlet.service(SlingSafeMethodsServlet.java:375)
	at org.apache.sling.engine.impl.request.RequestData.service(RequestData.java:523)
	at org.apache.sling.engine.impl.SlingMainServlet.processRequest(SlingMainServlet.java:427)
	at org.apache.sling.engine.impl.filter.RequestSlingFilterChain.render(RequestSlingFilterChain.java:48)
	at org.apache.sling.engine.impl.filter.AbstractSlingFilterChain.doFilter(AbstractSlingFilterChain.java:64)
	at org.apache.sling.engine.impl.debug.RequestProgressTrackerLogFilter.doFilter(RequestProgressTrackerLogFilter.java:59)
	at org.apache.sling.engine.impl.filter.AbstractSlingFilterChain.doFilter(AbstractSlingFilterChain.java:60)
	at org.sakaiproject.nakamura.batch.RequestEventsFilter.doFilter(RequestEventsFilter.java:96)
	at org.apache.sling.engine.impl.filter.AbstractSlingFilterChain.doFilter(AbstractSlingFilterChain.java:60)
	at org.sakaiproject.nakamura.files.pool.ContentPoolFilter.doFilter(ContentPoolFilter.java:77)
	at org.apache.sling.engine.impl.filter.AbstractSlingFilterChain.doFilter(AbstractSlingFilterChain.java:60)
	at org.sakaiproject.nakamura.privacy.RestPrivacyFilter.doFilter(RestPrivacyFilter.java:81)
	at org.apache.sling.engine.impl.filter.AbstractSlingFilterChain.doFilter(AbstractSlingFilterChain.java:60)
	at org.sakaiproject.nakamura.persistence.TransactionManagerFilter.doFilter(TransactionManagerFilter.java:95)
	at org.apache.sling.engine.impl.filter.AbstractSlingFilterChain.doFilter(AbstractSlingFilterChain.java:60)
	at org.sakaiproject.nakamura.cluster.ClusterTrackingFilter.doFilter(ClusterTrackingFilter.java:87)
	at org.apache.sling.engine.impl.filter.AbstractSlingFilterChain.doFilter(AbstractSlingFilterChain.java:60)
	at org.apache.sling.engine.impl.SlingMainServlet.service(SlingMainServlet.java:313)
	at org.apache.sling.engine.impl.SlingMainServlet.service(SlingMainServlet.java:207)
	at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:502)
	at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:389)
	at org.ops4j.pax.web.service.internal.HttpServiceServletHandler.handle(HttpServiceServletHandler.java:64)
	at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)
	at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765)
	at org.ops4j.pax.web.service.internal.HttpServiceContext.handle(HttpServiceContext.java:111)
	at org.ops4j.pax.web.service.internal.JettyServerHandlerCollection.handle(JettyServerHandlerCollection.java:64)
	at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)
	at org.mortbay.jetty.Server.handle(Server.java:324)
	at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:535)
	at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:865)
	at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:539)
	at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)
	at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)
	at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)
	at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:520)
</pre>
<h3>Request Progress:</h3>
<pre>
      0 (2010-11-02 10:15:06) TIMER_START{Request Processing}
      0 (2010-11-02 10:15:06) COMMENT timer_end format is {&lt;elapsed msec&gt;,&lt;timer name&gt;} &lt;optional message&gt;
      0 (2010-11-02 10:15:06) LOG Method=GET, PathInfo=/var/message/box.json
      0 (2010-11-02 10:15:06) TIMER_START{ResourceResolution}
      0 (2010-11-02 10:15:06) TIMER_END{0,ResourceResolution} URI=/var/message/box.json resolves to Resource=JcrNodeResource, type=sakai/search, superType=null, path=/var/message/box
      0 (2010-11-02 10:15:06) LOG Resource Path Info: SlingRequestPathInfo: path='/var/message/box', selectorString='null', extension='json', suffix='null'
      0 (2010-11-02 10:15:06) TIMER_START{ServletResolution}
      0 (2010-11-02 10:15:06) TIMER_START{resolveServlet(JcrNodeResource, type=sakai/search, superType=null, path=/var/message/box)}
      0 (2010-11-02 10:15:06) TIMER_END{0,resolveServlet(JcrNodeResource, type=sakai/search, superType=null, path=/var/message/box)} Using servlet org.sakaiproject.nakamura.search.SearchServlet
      0 (2010-11-02 10:15:06) TIMER_END{0,ServletResolution} URI=/var/message/box.json handled by Servlet=org.sakaiproject.nakamura.search.SearchServlet
      0 (2010-11-02 10:15:06) LOG Applying request filters
      0 (2010-11-02 10:15:06) LOG Calling filter: org.sakaiproject.nakamura.cluster.ClusterTrackingFilter
      1 (2010-11-02 10:15:06) LOG Calling filter: org.sakaiproject.nakamura.persistence.TransactionManagerFilter
      1 (2010-11-02 10:15:06) LOG Calling filter: org.sakaiproject.nakamura.privacy.RestPrivacyFilter
      1 (2010-11-02 10:15:06) LOG Calling filter: org.sakaiproject.nakamura.files.pool.ContentPoolFilter
      1 (2010-11-02 10:15:06) LOG Calling filter: org.sakaiproject.nakamura.batch.RequestEventsFilter
      1 (2010-11-02 10:15:06) LOG Calling filter: org.apache.sling.engine.impl.debug.RequestProgressTrackerLogFilter
      1 (2010-11-02 10:15:06) TIMER_START{org.sakaiproject.nakamura.search.SearchServlet#0}
      7 (2010-11-02 10:15:06) TIMER_END{6,org.sakaiproject.nakamura.search.SearchServlet#0}
      7 (2010-11-02 10:15:06) TIMER_START{handleError:throwable=java.util.NoSuchElementException}
      9 (2010-11-02 10:15:06) TIMER_END{2,handleError:throwable=java.util.NoSuchElementException} Using handler org.apache.sling.servlets.resolver.internal.defaults.DefaultErrorHandlerServlet
     11 (2010-11-02 10:15:06) TIMER_END{11,Request Processing} Dumping SlingRequestProgressTracker Entries





/{_userMessagePath}//element(*)MetaData[@sling:resourceType='sakai/message' and @sakai:type='notice'] order by @{sortOn|jcr:created} {sortOrder|descending}

